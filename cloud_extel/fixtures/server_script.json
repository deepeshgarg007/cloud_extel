[
 {
  "allow_guest": 0,
  "api_method": "get_income_accounts",
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "modified": "2020-06-03 15:04:50.840105",
  "name": "Income Account Query",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "reference_doctype": null,
  "script": "args = frappe.form_dict\ncustomer = args.get('customer')\ntelecom_circle = args.get('telecom_circle')\ncost_center = args.get('cost_center')\n\nterritory = frappe.db.get_value('Customer', customer, 'territory')\n\nparent = frappe.db.get_value('Allowed Revenue Account', {'customer': customer, 'telecom_circle': telecom_circle,\n    'cost_center': cost_center})\n\naccounts = frappe.db.get_all('Allowed Revenue Accounts Detail', fields=['account'], filters={'parent': parent}, as_list=1)\nallowed_accounts = [d[0] for d in accounts]\n\nlinked_address = frappe.db.get_all('Dynamic Link', fields=['parent'], filters={'link_doctype': 'Customer',\n    'link_name': customer, 'parenttype': 'Address'}, as_list = 1)\n\naddresses = frappe.db.get_all('Address', fields=['name'], filters={'telecom_circle': telecom_circle,  'cost_center': cost_center}, as_list=1)\n\nbilling_address = []\n\nfor b in linked_address:\n    for d in addresses:\n        if b==d:\n            billing_address = b\n            \nlinked_contact = frappe.db.get_all('Dynamic Link', fields=['parent'], filters={'link_doctype': 'Customer',\n    'link_name': customer, 'parenttype': 'Contact'}, as_list = 1)\n\ncontacts = frappe.db.get_all('Contact', fields=['name'], filters={'telecom_circle': telecom_circle,  'cost_center': cost_center}, as_list=1)\n\ncontact = []\n\nfor b in linked_contact:\n    for d in contacts:\n        if b==d:\n            contact = b\n\nfrappe.response['message'] = {\n    'territory': territory,\n    'accounts': allowed_accounts if allowed_accounts else '',\n    'address': billing_address[0] if billing_address else '',\n    'contact_person': contact[0] if contact else ''\n}\n",
  "script_type": "API"
 }
]